generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model OwnerUser {
  id                  String               @id @default(cuid())
  email               String               @unique
  passwordHash        String
  language            String               @default("ja")
  isAdmin             Boolean              @default(false)
  createdAt           DateTime             @default(now())
  bulletinPosts       BulletinPost[]
  bulletinTopics      BulletinTopic[]
  dogs                Dog[]
  diaries             DogDiary[]
  friendshipsA        Friendship[]         @relation("FriendshipA")
  friendshipsB        Friendship[]         @relation("FriendshipB")
  notifications       Notification[]
  notificationSetting NotificationSetting?
  ownerFriendsFriend  OwnerFriend[]        @relation("OwnerFriendFriend")
  ownerFriendsOwned   OwnerFriend[]        @relation("OwnerFriendOwner")
}

model Dog {
  id               String         @id @default(cuid())
  ownerId          String
  name             String
  sex              String
  breed            String
  birthday         String
  birthplace       String
  location         String
  personalityInput String
  ownerCalling     String         @default("パパ")
  createdAt        DateTime       @default(now())
  iconUrl          String?
  comments         Comment[]
  owner            OwnerUser      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  diaries          DogDiary[]
  persona          DogPersona?
  followers        Follow[]       @relation("Followed")
  following        Follow[]       @relation("Follower")
  likes            Like[]
  notifications    Notification[] @relation("FromDog")
  posts            Post[]
  reposts          Repost[]
}

model Follow {
  followerId String
  followedId String
  createdAt  DateTime @default(now())
  followed   Dog      @relation("Followed", fields: [followedId], references: [id], onDelete: Cascade)
  follower   Dog      @relation("Follower", fields: [followerId], references: [id], onDelete: Cascade)

  @@id([followerId, followedId])
}

model DogPersona {
  id                String   @id @default(cuid())
  dogId             String   @unique
  toneStyle         String
  emojiLevel        Int
  sociability       Int
  curiosity         Int
  calmness          Int
  bio               String   @default("")
  topicsJson        String
  dislikesJson      String
  catchphrasesJson  String
  behaviorJson      String
  learnedTopicsJson String   @default("[]")
  intelligence      Int      @default(5)
  updatedAt         DateTime @updatedAt
  dog               Dog      @relation(fields: [dogId], references: [id], onDelete: Cascade)
}

model DogDiary {
  id        String    @id @default(cuid())
  dogId     String
  ownerId   String
  date      String
  body      String
  summary   String    @default("")
  imageUrl  String?
  createdAt DateTime  @default(now())
  dog       Dog       @relation(fields: [dogId], references: [id], onDelete: Cascade)
  owner     OwnerUser @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model Post {
  id            String         @id @default(cuid())
  dogId         String
  content       String
  imageUrl      String?
  language      String         @default("ja")
  createdAt     DateTime       @default(now())
  comments      Comment[]
  likes         Like[]
  notifications Notification[]
  dog           Dog            @relation(fields: [dogId], references: [id], onDelete: Cascade)
  reposts       Repost[]
}

model Like {
  dogId     String
  postId    String
  createdAt DateTime @default(now())
  dog       Dog      @relation(fields: [dogId], references: [id], onDelete: Cascade)
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([dogId, postId])
}

model Comment {
  id        String   @id @default(cuid())
  dogId     String
  postId    String
  content   String
  language  String   @default("ja")
  createdAt DateTime @default(now())
  dog       Dog      @relation(fields: [dogId], references: [id], onDelete: Cascade)
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model Repost {
  dogId     String
  postId    String
  createdAt DateTime @default(now())
  dog       Dog      @relation(fields: [dogId], references: [id], onDelete: Cascade)
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([dogId, postId])
}

model Notification {
  id        String    @id @default(cuid())
  ownerId   String
  type      String
  postId    String?
  fromDogId String
  createdAt DateTime  @default(now())
  readAt    DateTime?
  fromDog   Dog       @relation("FromDog", fields: [fromDogId], references: [id], onDelete: Cascade)
  owner     OwnerUser @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  post      Post?     @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model Friendship {
  id        String    @id @default(cuid())
  userAId   String
  userBId   String
  status    String    @default("PENDING")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  userA     OwnerUser @relation("FriendshipA", fields: [userAId], references: [id], onDelete: Cascade)
  userB     OwnerUser @relation("FriendshipB", fields: [userBId], references: [id], onDelete: Cascade)

  @@unique([userAId, userBId])
}

model NotificationSetting {
  id            String    @id @default(cuid())
  ownerId       String    @unique
  notifyLike    Boolean   @default(true)
  notifyComment Boolean   @default(true)
  notifyFollow  Boolean   @default(true)
  notifyFriend  Boolean   @default(true)
  notifyBuzz    Boolean   @default(true)
  owner         OwnerUser @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model OwnerFriend {
  id        String    @id @default(cuid())
  ownerId   String
  friendId  String
  memo      String    @default("")
  createdAt DateTime  @default(now())
  friend    OwnerUser @relation("OwnerFriendFriend", fields: [friendId], references: [id], onDelete: Cascade)
  owner     OwnerUser @relation("OwnerFriendOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  @@unique([ownerId, friendId])
}

model BulletinTopic {
  id        String         @id @default(cuid())
  ownerId   String
  title     String
  body      String
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  pinned    Boolean        @default(false)
  posts     BulletinPost[]
  owner     OwnerUser      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model BulletinPost {
  id        String        @id @default(cuid())
  topicId   String
  ownerId   String
  content   String
  createdAt DateTime      @default(now())
  owner     OwnerUser     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  topic     BulletinTopic @relation(fields: [topicId], references: [id], onDelete: Cascade)
}

model Product {
  id          String   @id @default(cuid())
  title       String
  description String?
  amazonUrl   String
  imageUrl    String?
  category    String
  price       String?
  isFeatured   Boolean  @default(false)
  displayOrder Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
